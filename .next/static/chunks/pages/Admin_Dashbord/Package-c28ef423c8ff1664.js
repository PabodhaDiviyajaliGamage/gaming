(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{8824:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Admin_Dashbord/Package",function(){return t(8364)}])},8364:function(e,a,t){"use strict";t.r(a);var r=t(5893),s=t(7294),n=t(7066),o=t(8808);a.default=()=>{var e;let[a,t]=(0,s.useState)([]),[i,l]=(0,s.useState)([]),[c,d]=(0,s.useState)({packagename:"",price:"",gamename:"",description:"",image:null,gameId:""}),[g,m]=(0,s.useState)(null),p=(0,s.useRef)(null),[u,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(!0),[k,b]=(0,s.useState)(""),[v,y]=(0,s.useState)(""),[j,N]=(0,s.useState)(null),w=async()=>{f(!0),N("Testing API connection...");try{let e=localStorage.getItem("token");console.log("Testing endpoint: /api/package");let a=await n.Z.get((0,o.kG)("/api/package"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}});console.log("API test response:",a.data),N("API connection successful using endpoint: /api/package")}catch(e){console.error("API connection test failed:",e),N("API connection test failed: ".concat(e.message))}finally{setTimeout(()=>f(!1),500)}};(0,s.useEffect)(()=>{I(),S(),w()},[]),(0,s.useEffect)(()=>{console.log("Current packages data:",a),console.log("Current games data:",i)},[a,i]);let S=async()=>{try{let e=localStorage.getItem("token");if(!e){console.error("Authentication token not found"),b("Authentication token not found. Please log in again.");return}console.log("Fetching games data from /api/game...");let a=await n.Z.get((0,o.kG)("/api/game"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}});console.log("Games response:",a.data);let t=[];a.data&&Array.isArray(a.data)?t=a.data:a.data&&a.data.data&&Array.isArray(a.data.data)?t=a.data.data:a.data&&a.data.data&&(t=[a.data.data]),l(t),localStorage.setItem("gamesData",JSON.stringify(t))}catch(t){var e,a;console.error("Error fetching games:",t),b("Failed to fetch games: "+((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||t.message));try{let e=localStorage.getItem("gamesData");if(e){let a=JSON.parse(e);Array.isArray(a)&&a.length>0&&(l(a),b("Could not connect to the server. Using locally stored games data."))}}catch(e){console.error("Error using local games fallback:",e)}}},I=async()=>{f(!0),b("");try{let e=localStorage.getItem("token");if(!e){b("Authentication token not found. Please log in again."),f(!1);return}console.log("Fetching packages from /api/package...");let a=await n.Z.get((0,o.kG)("/api/package"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}});console.log("Packages response:",a.data);let r=[];a.data&&Array.isArray(a.data)?r=a.data:a.data&&a.data.data&&Array.isArray(a.data.data)?r=a.data.data:a.data&&a.data.data&&(r=[a.data.data]),r.length>0&&(console.log("First package structure:",JSON.stringify(r[0],null,2)),console.log("Image field:",r[0].image),console.log("Game name field:",r[0].gamename),console.log("Game ID field:",r[0].gameId)),t(r),y("Packages loaded successfully"),setTimeout(()=>y(""),3e3),localStorage.setItem("packagesData",JSON.stringify(r))}catch(r){var e,a;console.error("Error fetching packages:",r),b("Failed to fetch packages: "+((null===(a=r.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||r.message));try{let e=localStorage.getItem("packagesData");if(e){let a=JSON.parse(e);Array.isArray(a)&&a.length>0&&(t(a),b("Could not connect to the server. Using locally stored packages data."))}}catch(e){console.error("Error using local fallback:",e)}}finally{f(!1)}},A=e=>{let{name:a,value:t}=e.target;u?h({...u,[a]:t}):d({...c,[a]:t})},P=async e=>{if(e.preventDefault(),b(""),y(""),c.description.length<10){b("Description must be at least 10 characters long");return}f(!0);try{let e=localStorage.getItem("token");if(!e){b("Authentication token not found. Please log in again."),f(!1);return}let a=i.find(e=>e.gamename===c.gamename);if(!a||!a._id){b("Please select a valid game from the dropdown. The selected game was not found."),f(!1);return}let t=new FormData;t.append("packagename",c.packagename),t.append("price",c.price),t.append("gamename",c.gamename),t.append("description",c.description),t.append("gameId",a._id),c.image instanceof File&&t.append("image",c.image),console.log("Adding package with data:",{packagename:c.packagename,price:c.price,gamename:c.gamename,description:c.description,gameId:a._id,hasImage:c.image instanceof File});let r=await n.Z.post((0,o.kG)("/api/package"),t,{headers:{...e?{Authorization:"Bearer ".concat(e)}:{}}});console.log("Package added response:",r.data),d({packagename:"",price:"",gamename:"",description:"",image:null,gameId:""}),m(null),p.current&&(p.current.value=""),y("Package added successfully!");let s=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[];s.push({packagename:c.packagename,price:c.price,gamename:c.gamename,description:c.description,gameId:a._id,image:r.data.image||r.data.imageUrl||"",_id:r.data._id||Date.now().toString(),createdAt:new Date().toISOString()}),localStorage.setItem("packagesData",JSON.stringify(s)),I(),setTimeout(()=>y(""),3e3)}catch(s){var r;console.error("Error adding package:",(null===(r=s.response)||void 0===r?void 0:r.data)||s.message);let e="Failed to add package: ";s.response?(console.error("Error response data:",s.response.data),console.error("Error response status:",s.response.status),e+="Server responded with status: ".concat(s.response.status,". "),s.response.data&&"object"==typeof s.response.data?s.response.data.message?e+=s.response.data.message:s.response.data.error?e+=s.response.data.error:e+=JSON.stringify(s.response.data):"string"==typeof s.response.data&&(e+=s.response.data)):s.request?e+="No response received from server. Please check your connection.":e+=s.message,b(e);try{let e=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[],r=i.find(e=>e.gamename===c.gamename),s={packagename:c.packagename,price:c.price,gamename:c.gamename,description:c.description,gameId:(null==r?void 0:r._id)||"",_id:Date.now().toString(),createdAt:new Date().toISOString()};e.push(s),localStorage.setItem("packagesData",JSON.stringify(e)),t([...a,s]),y("Added to local storage only. Server connection failed.")}catch(e){console.error("Error saving to local storage:",e)}}finally{f(!1)}},_=async e=>{var a,t,r;if(e.preventDefault(),b(""),y(""),u.description.length<10){b("Description must be at least 10 characters long");return}f(!0);try{let e;let r=localStorage.getItem("token"),s=r?{Authorization:"Bearer ".concat(r)}:{};if(!r){b("Authentication token not found. Please log in again."),f(!1);return}let l=i.find(e=>e.gamename===u.gamename);if(!l||!l._id){b("Please select a valid game from the dropdown. The selected game was not found."),f(!1);return}if(u.image instanceof File){let a=new FormData;a.append("packagename",u.packagename),a.append("price",u.price),a.append("gamename",u.gamename),a.append("description",u.description),a.append("gameId",l._id),a.append("image",u.image),console.log("Updating package with image:",{id:u._id,packagename:u.packagename,hasImage:!0}),e=await n.Z.put((0,o.kG)("/api/package/".concat(u._id)),a,{headers:{...s}})}else{let a={packagename:u.packagename,price:u.price,gamename:u.gamename,description:u.description,gameId:l._id};"string"==typeof u.image&&u.image&&(a.keepExistingImage=!0),console.log("Updating package with data:",a),e=await n.Z.put((0,o.kG)("/api/package/".concat(u._id)),a,{headers:{...s,"Content-Type":"application/json"}})}console.log("Package updated response:",null==e?void 0:e.data),y("Package updated successfully!");let c=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[],d=c.findIndex(e=>e._id===u._id);-1!==d&&(c[d]={...c[d],packagename:u.packagename,price:u.price,gamename:u.gamename,description:u.description,gameId:l._id,image:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.image)||(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.imageUrl)||c[d].image,updatedAt:new Date().toISOString()},localStorage.setItem("packagesData",JSON.stringify(c))),h(null),m(null),p.current&&(p.current.value=""),I(),setTimeout(()=>y(""),3e3)}catch(a){console.error("Error updating package:",(null===(r=a.response)||void 0===r?void 0:r.data)||a.message);let e="Failed to update package: ";a.response?(console.error("Error response data:",a.response.data),console.error("Error response status:",a.response.status),e+="Server responded with status: ".concat(a.response.status,". "),a.response.data&&"object"==typeof a.response.data?a.response.data.message?e+=a.response.data.message:a.response.data.error?e+=a.response.data.error:e+=JSON.stringify(a.response.data):"string"==typeof a.response.data&&(e+=a.response.data)):a.request?e+="No response received from server. Please check your connection.":e+=a.message,b(e)}finally{f(!1)}},D=async e=>{if(confirm("Are you sure you want to delete this package?")){b(""),y(""),f(!0);try{let a=localStorage.getItem("token");if(!a){b("Authentication token not found. Please log in again."),f(!1);return}console.log("Deleting package with ID: ".concat(e)),await n.Z.delete((0,o.kG)("/api/package/".concat(e)),{headers:a?{Authorization:"Bearer ".concat(a)}:{}}),y("Package deleted successfully!");let t=(localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[]).filter(a=>a._id!==e);localStorage.setItem("packagesData",JSON.stringify(t)),I(),setTimeout(()=>y(""),3e3)}catch(t){var a;console.error("Error deleting package:",(null===(a=t.response)||void 0===a?void 0:a.data)||t.message);let e="Failed to delete package: ";t.response?(console.error("Error response data:",t.response.data),console.error("Error response status:",t.response.status),e+="Server responded with status: ".concat(t.response.status,". "),t.response.data&&"object"==typeof t.response.data?t.response.data.message?e+=t.response.data.message:t.response.data.error?e+=t.response.data.error:e+=JSON.stringify(t.response.data):"string"==typeof t.response.data&&(e+=t.response.data)):t.request?e+="No response received from server. Please check your connection.":e+=t.message,b(e)}finally{f(!1)}}};return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Available Packages"}),j&&(0,r.jsx)("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{children:j}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:w,className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition-colors",disabled:x,children:"Test API"})})]})}),v&&(0,r.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:(0,r.jsx)("p",{children:v})}),k&&(0,r.jsxs)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:[(0,r.jsx)("p",{children:k}),(0,r.jsx)("button",{className:"mt-2 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded",onClick:I,children:"Try Again"})]}),(0,r.jsxs)("form",{onSubmit:u?_:P,className:"mb-6 p-6 bg-gray-200 rounded",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:u?"Edit Package":"Add New Package"}),k&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:k}),(0,r.jsx)("input",{type:"text",name:"packagename",placeholder:"Package Name",value:u?u.packagename:c.packagename,onChange:A,className:"border p-2 w-full mb-2",required:!0}),(0,r.jsx)("input",{type:"text",name:"price",placeholder:"Price",value:u?u.price:c.price,onChange:A,className:"border p-2 w-full mb-2",required:!0}),(0,r.jsxs)("select",{name:"gamename",value:u?u.gamename:c.gamename,onChange:A,className:"border p-2 w-full mb-2",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a Game"}),i.map(e=>(0,r.jsx)("option",{value:e.gamename,children:e.gamename},e._id))]}),(0,r.jsx)("textarea",{name:"description",placeholder:"Description (minimum 10 characters)",value:u?u.description:c.description,onChange:A,className:"border p-2 w-full mb-1 ".concat(u&&u.description.length<10||!u&&c.description.length<10&&c.description.length>0?"border-red-500":""),required:!0}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mb-4 flex justify-between",children:[(0,r.jsx)("span",{children:"Minimum 10 characters required"}),(0,r.jsx)("span",{children:u?"".concat(u.description.length,"/10 characters"):"".concat(c.description.length,"/10 characters")})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Image"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",ref:p,onChange:e=>{let a=e.target.files[0];if(!a)return;if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(a.type)){b("Please select a valid image file (JPEG, PNG, JPG, GIF)");return}if(a.size>2097152){b("Image size should be less than 2MB");return}let t=new FileReader;t.onloadend=()=>{m(t.result),u?h({...u,image:a}):d({...c,image:a})},t.readAsDataURL(a)},className:"hidden",id:"packageImageUpload"}),(0,r.jsxs)("label",{htmlFor:"packageImageUpload",className:"cursor-pointer bg-blue-500 hover:bg-blue-600 text-white rounded px-3 py-2 text-sm flex-grow flex items-center justify-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(null==u?void 0:u.image)?"string"==typeof u.image?"Change image":"Selected: ".concat(u.image.name.substring(0,15)).concat(u.image.name.length>15?"...":""):(null==c?void 0:null===(e=c.image)||void 0===e?void 0:e.name)?"Selected: ".concat(c.image.name.substring(0,15)).concat(c.image.name.length>15?"...":""):"Choose image file..."]}),(0,r.jsx)("button",{type:"button",onClick:()=>{u?h({...u,image:null}):d({...c,image:null}),m(null),p.current&&(p.current.value="")},className:"bg-red-500 hover:bg-red-600 text-white px-2 py-2 rounded text-sm",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("div",{className:"relative w-32 h-32 border rounded overflow-hidden bg-gray-100",children:g?(0,r.jsx)("img",{src:g,alt:"Preview",className:"w-full h-full object-cover"}):u&&"string"==typeof u.image&&u.image?(0,r.jsx)("img",{src:u.image.startsWith("http")?u.image:(0,o.kG)("/".concat(u.image)),alt:u.packagename,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/100?text=No+Image"}}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full w-full bg-gray-200 text-gray-500 text-xs text-center p-2",children:(0,r.jsx)("span",{children:"No image selected"})})})})]}),(0,r.jsx)("button",{type:"submit",className:"".concat(u?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"," text-white px-4 py-2 rounded transition-colors"),disabled:x||u&&u.description.length<10||!u&&c.description.length<10,children:x?u?"Updating...":"Adding...":u?"Update Package":"Add Package"}),(u&&u.description.length<10||!u&&c.description.length<10)&&(0,r.jsx)("div",{className:"mt-2 text-sm text-orange-600",children:(0,r.jsx)("p",{children:"Note: Button will be enabled when description has at least 10 characters"})})]}),x?(0,r.jsx)("div",{className:"text-center py-4",children:(0,r.jsx)("p",{children:"Loading packages..."})}):k&&0===a.length?(0,r.jsx)("div",{className:"text-center py-4 text-red-500",children:(0,r.jsx)("p",{children:k})}):0===a.length?(0,r.jsx)("p",{children:"No packages found."}):(0,r.jsxs)("table",{className:"w-full border border-gray-300 rounded",children:[(0,r.jsx)("thead",{className:"bg-[#0e08ab] text-white",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"border p-2",children:"Package ID"}),(0,r.jsx)("th",{className:"border p-2",children:"Name"}),(0,r.jsx)("th",{className:"border p-2",children:"Price"}),(0,r.jsx)("th",{className:"border p-2",children:"Game"}),(0,r.jsx)("th",{className:"border p-2",children:"Description"}),(0,r.jsx)("th",{className:"border p-2",children:"Image"}),(0,r.jsx)("th",{className:"border p-2",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:a.map(e=>{var a;return(0,r.jsxs)("tr",{className:"text-center bg-gray-100",children:[(0,r.jsx)("td",{className:"border p-2",children:e._id}),(0,r.jsx)("td",{className:"border p-2",children:e.packagename}),(0,r.jsx)("td",{className:"border p-2",children:e.price}),(0,r.jsx)("td",{className:"border p-2",children:e.gamename||e.gameId&&(null===(a=i.find(a=>a._id===e.gameId))||void 0===a?void 0:a.gamename)||"Unknown Game"}),(0,r.jsx)("td",{className:"border p-2",children:e.description}),(0,r.jsx)("td",{className:"border p-2",children:e.image?(0,r.jsx)("div",{className:"h-16 w-16 mx-auto overflow-hidden rounded bg-gray-100",children:(0,r.jsx)("img",{src:e.image.startsWith("http")?e.image:(0,o.kG)("/".concat(e.image)),alt:e.packagename,className:"h-full w-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/100?text=Error"}})}):(0,r.jsx)("div",{className:"h-16 w-16 mx-auto flex items-center justify-center bg-gray-200 rounded",children:(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"No image"})})}),(0,r.jsxs)("td",{className:"border p-2 space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{e.image&&"string"==typeof e.image?m(e.image.startsWith("http")?e.image:(0,o.kG)("/".concat(e.image))):m(null),h(e),p.current&&(p.current.value="")},className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded transition-colors",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>D(e._id),className:"bg-red-500 text-white px-3 py-1 rounded",children:"Delete"})]})]},e._id)})})]}),(0,r.jsxs)("div",{className:"mt-6 flex justify-between items-center text-sm text-gray-500",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("p",{children:["Total Packages: ",a.length]})}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:I,className:"text-blue-600 hover:text-blue-800 underline",disabled:x,children:x?"Refreshing...":"Refresh Data"})})]})]})}},8808:function(e,a,t){"use strict";t.d(a,{NU:function(){return n},kG:function(){return s}});let r=t(3454).env.NEXT_PUBLIC_API_URL||"/api",s=e=>{let a=e.startsWith("/")?e.slice(1):e;return"".concat(r,"/").concat(a)},n=e=>{let a={"Content-Type":"application/json"};return e&&(a.Authorization="Bearer ".concat(e)),a}}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=8824)}),_N_E=e.O()}]);