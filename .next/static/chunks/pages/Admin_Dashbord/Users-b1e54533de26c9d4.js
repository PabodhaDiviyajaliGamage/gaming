(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{5400:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Admin_Dashbord/Users",function(){return r(8429)}])},2603:function(e,a,r){"use strict";r.d(a,{Hz:function(){return o}});var t=r(3454);let s=t.env.NEXT_PUBLIC_API_URL||"/api",o={API_BASE_URL:s,API_ENDPOINTS:{auth:{login:"".concat(s,"/auth/login"),register:"".concat(s,"/auth/register"),logout:"".concat(s,"/auth/logout"),verify:"".concat(s,"/auth/verify")},users:"".concat(s,"/users"),games:"".concat(s,"/games"),packages:"".concat(s,"/packages"),orders:"".concat(s,"/orders")},LOGGING_ENABLED:"true"===t.env.VITE_API_LOGGING}},8429:function(e,a,r){"use strict";r.r(a);var t=r(5893),s=r(7294),o=r(7066);r(2603);var l=r(8808);a.default=()=>{let[e,a]=(0,s.useState)([]),[r,n]=(0,s.useState)(null),[i,c]=(0,s.useState)({name:"",email:"",phone:"",role:""}),[d,u]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)({name:"",email:"",phone:"",password:"",role:"user"}),y=e=>{if(!e)return"user";let a="string"==typeof e?e.toLowerCase():String(e).toLowerCase();return"admin"===a||"administrator"===a?"admin":"user"};(0,s.useEffect)(()=>{N()},[]);let N=async()=>{u(!0),p(null);try{let e=localStorage.getItem("token");if(!e){p("Authentication token not found. Please login again."),u(!1);return}console.log("Fetching users with token:",e);let r=!1,t=[];try{let a=await o.Z.get((0,l.kG)("/api/users"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("Primary API response:",a.data),Array.isArray(a.data)?(t=a.data,r=!0):a.data&&Array.isArray(a.data.users)?(t=a.data.users,r=!0):a.data&&"object"==typeof a.data&&(t=[a.data],r=!0)}catch(a){console.error("Primary endpoint failed, trying alternative endpoint",a);try{let a=await o.Z.get((0,l.kG)("/api/user-management/users"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("Alternative API response:",a.data),Array.isArray(a.data)?(t=a.data,r=!0):a.data&&Array.isArray(a.data.users)?(t=a.data.users,r=!0):a.data&&"object"==typeof a.data&&(t=[a.data],r=!0)}catch(a){console.error("Alternative endpoint also failed",a);try{let a=await o.Z.get((0,l.kG)("/api/user/all"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("Third API response:",a.data),Array.isArray(a.data)?(t=a.data,r=!0):a.data&&Array.isArray(a.data.users)?(t=a.data.users,r=!0):a.data&&"object"==typeof a.data&&(t=[a.data],r=!0)}catch(e){console.error("Third endpoint also failed",e)}}}if(!r){console.log("All API endpoints failed, falling back to localStorage");let e=JSON.parse(localStorage.getItem("users")||"[]");console.log("Users from localStorage:",e),t=e,0===t.length&&(t=[{_id:"admin_default",name:"Admin User",email:"admin@example.com",phone:"1234567890",role:"admin",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],localStorage.setItem("users",JSON.stringify(t)),console.log("Created default admin in localStorage"))}t.forEach(e=>{console.log("User ".concat(e._id,": role = ").concat(e.role,", normalized = ").concat(y(e.role)))}),a(t),u(!1)}catch(t){var e,r;console.error("Error fetching users:",t),p("Failed to fetch users. "+((null===(r=t.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||t.message));try{let e=JSON.parse(localStorage.getItem("users")||"[]");console.log("Error recovery: Using users from localStorage:",e),a(e)}catch(e){console.error("Error reading from localStorage:",e),a([])}u(!1)}},A=async(e,a)=>{if(!e){p("Cannot update user without an ID");return}try{let r=localStorage.getItem("token");if(!r){p("Authentication token not found. Please login again.");return}let t=!1;try{try{console.log("Toggling user status to: ".concat(!a)),await o.Z.patch((0,l.kG)("/api/users/status/".concat(e)),{isActive:!a},{headers:{Authorization:"Bearer ".concat(r)}}),t=!0}catch(s){console.error("Status endpoint failed, trying alternative endpoint:",s);try{await o.Z.patch((0,l.kG)("/api/users/".concat(e,"/status")),{isActive:!a},{headers:{Authorization:"Bearer ".concat(r)}}),t=!0}catch(s){console.error("Alternative endpoint failed, trying standard update with active field:",s);try{await o.Z.patch((0,l.kG)("/api/users/".concat(e)),{isActive:!a,active:!a,status:a?"inactive":"active"},{headers:{Authorization:"Bearer ".concat(r)}}),t=!0}catch(e){console.error("All API endpoints failed:",e)}}}}catch(e){console.error("API failed:",e)}if(!t){console.log("API calls failed, using localStorage for status toggle");let r=JSON.parse(localStorage.getItem("users")||"[]").map(r=>r._id===e?{...r,isActive:!a,active:!a,updatedAt:new Date().toISOString()}:r);localStorage.setItem("users",JSON.stringify(r)),console.log("User status updated in localStorage")}N()}catch(e){var r,t;console.error("Error updating user status:",e),p("Failed to update user status. "+((null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}},w=async e=>{if(!e){p("Cannot delete user without an ID");return}if(window.confirm("Are you sure you want to delete this user?"))try{u(!0);let a=localStorage.getItem("token");if(!a){p("Authentication token not found. Please login again."),u(!1);return}console.log("Attempting to delete user with ID: ".concat(e));let r=!1;try{await o.Z.delete((0,l.kG)("/api/users/".concat(e)),{headers:{Authorization:"Bearer ".concat(a)}}),console.log("User deleted successfully"),r=!0}catch(t){console.error("Primary delete endpoint failed:",t);try{await o.Z.delete((0,l.kG)("/api/user/".concat(e)),{headers:{Authorization:"Bearer ".concat(a)}}),console.log("User deleted successfully via alternative endpoint"),r=!0}catch(e){console.error("Alternative delete endpoint failed:",e)}}if(!r){console.log("API calls failed, using localStorage for user deletion");let a=JSON.parse(localStorage.getItem("users")||"[]").filter(a=>a._id!==e);localStorage.setItem("users",JSON.stringify(a)),console.log("User deleted from localStorage")}alert("User deleted successfully"),N()}catch(e){if(console.error("Error deleting user:",e),e.response){var a;console.error("API response status:",e.response.status),console.error("API response data:",e.response.data),p("Failed to delete user: "+((null===(a=e.response.data)||void 0===a?void 0:a.message)||e.message))}else e.request?(console.error("No response received:",e.request),p("Failed to delete user: No response from server. Check your network connection.")):(console.error("Error details:",e),p("Failed to delete user: "+(e.message||"Unknown error")));u(!1)}},j=e=>{if(!e||!e._id){p("Cannot edit user without proper data");return}console.log("Starting edit for user:",e);let a=y(e.role);console.log("Current user role:",a,"Original value:",e.role),n(e._id),c({name:e.name||"",email:e.email||"",phone:e.phone||"",role:a}),console.log("Form data initialized:",{name:e.name||"",email:e.email||"",phone:e.phone||"",role:a})},S=async e=>{if(!e){p("Cannot save user without an ID");return}g(!0),p(null);try{let a=localStorage.getItem("token");if(!a){p("Authentication token not found. Please login again."),g(!1);return}console.log("Saving user with ID:",e),console.log("Form data being sent:",i);let r={name:i.name,email:i.email,phone:i.phone,role:i.role};console.log("Final data being sent:",r);let t=!1,s=null;try{s=await o.Z.put((0,l.kG)("/api/users/".concat(e)),r,{headers:{Authorization:"Bearer ".concat(a)}}),t=!0,console.log("Update successful via PUT /api/users/:id",s.data)}catch(n){console.error("PUT request failed, trying PATCH",n);try{s=await o.Z.patch((0,l.kG)("/api/users/".concat(e)),r,{headers:{Authorization:"Bearer ".concat(a)}}),t=!0,console.log("Update successful via PATCH /api/users/:id",s.data)}catch(n){console.error("PATCH request also failed, trying alternative endpoint",n);try{s=await o.Z.put((0,l.kG)("/api/user/".concat(e)),r,{headers:{Authorization:"Bearer ".concat(a)}}),t=!0,console.log("Update successful via PUT /api/user/:id",s.data)}catch(e){console.error("All update attempts failed",e)}}}if(!t){console.log("API calls failed, using localStorage for user update");let a=JSON.parse(localStorage.getItem("users")||"[]").map(a=>a._id===e?{...a,name:i.name,email:i.email,phone:i.phone,role:i.role,updatedAt:new Date().toISOString()}:a);localStorage.setItem("users",JSON.stringify(a)),console.log("User updated in localStorage")}alert("User updated successfully"),n(null),N()}catch(e){if(console.error("Error editing user:",e),e.response){var a;console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),p("Failed to save user: "+((null===(a=e.response.data)||void 0===a?void 0:a.message)||e.message))}else e.request?(console.error("No response received:",e.request),p("Failed to save user: No response from server. Check your network connection.")):(console.error("Error details:",e),p("Failed to save user: "+(e.message||"Unknown error")))}finally{g(!1)}},k=async()=>{if(!v.name||!v.email||!v.password){p("Name, email, and password are required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.email)){p("Please enter a valid email address");return}u(!0),p(null);try{let e=localStorage.getItem("token");if(!e){p("Authentication token not found. Please login again."),u(!1);return}console.log("Creating new user:",v);let a=!1;try{let r=await o.Z.post((0,l.kG)("/api/users"),v,{headers:{Authorization:"Bearer ".concat(e)}});console.log("User created successfully:",r.data),a=!0}catch(r){console.error("Primary create endpoint failed:",r);try{let r=await o.Z.post((0,l.kG)("/api/auth/register"),{...v,isAdmin:"admin"===v.role},{headers:{Authorization:"Bearer ".concat(e)}});console.log("User created successfully via alternative endpoint:",r.data),a=!0}catch(e){console.error("Alternative create endpoint failed:",e)}}if(!a){console.log("API calls failed, using localStorage fallback");let e=JSON.parse(localStorage.getItem("users")||"[]"),a={_id:"user_"+Date.now(),name:v.name,email:v.email,phone:v.phone||"",password:v.password,role:v.role,isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};e.push(a),localStorage.setItem("users",JSON.stringify(e)),console.log("User saved to localStorage:",a)}alert("".concat("admin"===v.role?"Admin":"User"," created successfully!")),b({name:"",email:"",phone:"",password:"",role:"user"}),f(!1),N()}catch(a){if(console.error("Error creating user:",a),a.response){var e;console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),p("Failed to create user: "+((null===(e=a.response.data)||void 0===e?void 0:e.message)||a.message))}else a.request?(console.error("No response received:",a.request),p("Failed to create user: No response from server. Check your network connection.")):(console.error("Error details:",a),p("Failed to create user: "+(a.message||"Unknown error")))}finally{u(!1)}};return(0,t.jsxs)("div",{className:"p-2 sm:p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Users"}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)("button",{className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md",onClick:()=>{f(!0),b({name:"",email:"",phone:"",password:"",role:"admin"})},children:"Add Admin"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",onClick:()=>{f(!0),b({name:"",email:"",phone:"",password:"",role:"user"})},children:"Add User"})]})]}),x&&(0,t.jsxs)("div",{className:"bg-gray-100 p-4 mb-6 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"admin"===v.role?"Add New Admin":"Add New User"}),(0,t.jsx)("button",{className:"text-gray-600 hover:text-gray-800",onClick:()=>f(!1),children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,t.jsx)("input",{type:"text",value:v.name,onChange:e=>b({...v,name:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Full Name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,t.jsx)("input",{type:"email",value:v.email,onChange:e=>b({...v,email:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Email Address"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,t.jsx)("input",{type:"text",value:v.phone,onChange:e=>b({...v,phone:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Phone Number"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,t.jsx)("input",{type:"password",value:v.password,onChange:e=>b({...v,password:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Password"})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,t.jsxs)("select",{value:v.role,onChange:e=>b({...v,role:e.target.value}),className:"border p-2 w-full rounded",children:[(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,t.jsx)("div",{className:"mt-4 flex justify-end",children:(0,t.jsxs)("button",{className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",onClick:k,children:["Create ","admin"===v.role?"Admin":"User"]})})]}),m&&(0,t.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,t.jsx)("p",{children:m}),(0,t.jsx)("button",{className:"mt-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded",onClick:N,children:"Try Again"})]}),d?(0,t.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,t.jsx)("div",{className:"overflow-x-auto",children:Array.isArray(e)&&0!==e.length?(0,t.jsxs)("table",{className:"w-full border text-xs sm:text-base",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-[#0e08ab] text-white",children:[(0,t.jsx)("th",{className:"p-2 border",children:"ID"}),(0,t.jsx)("th",{className:"p-2 border",children:"Name"}),(0,t.jsx)("th",{className:"p-2 border",children:"Email"}),(0,t.jsx)("th",{className:"p-2 border",children:"Phone"}),(0,t.jsx)("th",{className:"p-2 border",children:"Role"}),(0,t.jsx)("th",{className:"p-2 border",children:"Status"}),(0,t.jsx)("th",{className:"p-2 border",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e.map((e,a)=>(0,t.jsxs)("tr",{className:"bg-white even:bg-gray-100",children:[(0,t.jsx)("td",{className:"p-2 border break-all",children:e._id||"N/A"}),r===e._id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("td",{className:"p-2 border",children:(0,t.jsx)("input",{type:"text",value:i.name,onChange:e=>c({...i,name:e.target.value}),className:"border p-1 w-full"})}),(0,t.jsx)("td",{className:"p-2 border",children:(0,t.jsx)("input",{type:"email",value:i.email,onChange:e=>c({...i,email:e.target.value}),className:"border p-1 w-full"})}),(0,t.jsx)("td",{className:"p-2 border",children:(0,t.jsx)("input",{type:"text",value:i.phone,onChange:e=>c({...i,phone:e.target.value}),className:"border p-1 w-full"})}),(0,t.jsx)("td",{className:"p-2 border",children:(0,t.jsxs)("select",{value:i.role,onChange:e=>{console.log("Role changed to:",e.target.value),c({...i,role:e.target.value})},className:"border p-1 w-full",children:[(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("td",{className:"p-2 border break-all",children:e.name||"N/A"}),(0,t.jsx)("td",{className:"p-2 border break-all",children:e.email||"N/A"}),(0,t.jsx)("td",{className:"p-2 border break-all",children:e.phone||"N/A"}),(0,t.jsx)("td",{className:"p-2 border",children:"admin"===y(e.role)?(0,t.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full",children:"Admin"}):(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:"User"})})]}),(0,t.jsx)("td",{className:"p-2 border",children:e.isActive||e.active?"Active":"Inactive"}),(0,t.jsxs)("td",{className:"p-2 border flex gap-2 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>A(e._id,e.isActive||e.active),className:"px-2 py-1 rounded text-white ".concat(e.isActive||e.active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"),children:e.isActive||e.active?"Deactivate":"Activate"}),r===e._id?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>S(e._id),className:"px-2 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white flex items-center",disabled:h,children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"}),(0,t.jsx)("button",{onClick:()=>n(null),className:"px-2 py-1 rounded bg-gray-500 hover:bg-gray-600 text-white",disabled:h,children:"Cancel"})]}):(0,t.jsx)("button",{onClick:()=>j(e),className:"px-2 py-1 rounded bg-yellow-500 hover:bg-yellow-600 text-white",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>w(e._id),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-800 text-white",children:"Delete"})]})]},e._id||"user-".concat(a)))})]}):(0,t.jsx)("p",{className:"text-center py-4",children:"No users found"})})]})}},8808:function(e,a,r){"use strict";r.d(a,{NU:function(){return o},kG:function(){return s}});let t=r(3454).env.NEXT_PUBLIC_API_URL||"/api",s=e=>"".concat(t,"/").concat(e),o=e=>{let a={"Content-Type":"application/json"};return e&&(a.Authorization="Bearer ".concat(e)),a}}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=5400)}),_N_E=e.O()}]);