"use strict";(()=>{var e={};e.id=600,e.ids=[600,660],e.modules={1323:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},8421:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>x,default:()=>m,getServerSideProps:()=>f,getStaticPaths:()=>h,getStaticProps:()=>u,reportWebVitals:()=>b,routeModule:()=>S,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>N,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>k});var s=t(7093),n=t(5244),o=t(1323),i=t(1682),l=t.n(i),c=t(8141),d=t.n(c),g=t(8364),p=e([g]);g=(p.then?(await p)():p)[0];let m=(0,o.l)(g,"default"),u=(0,o.l)(g,"getStaticProps"),h=(0,o.l)(g,"getStaticPaths"),f=(0,o.l)(g,"getServerSideProps"),x=(0,o.l)(g,"config"),b=(0,o.l)(g,"reportWebVitals"),k=(0,o.l)(g,"unstable_getStaticProps"),y=(0,o.l)(g,"unstable_getStaticPaths"),j=(0,o.l)(g,"unstable_getStaticParams"),v=(0,o.l)(g,"unstable_getServerProps"),N=(0,o.l)(g,"unstable_getServerSideProps"),S=new s.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/Admin_Dashbord/Package",pathname:"/Admin_Dashbord/Package",bundlePath:"",filename:""},components:{App:d(),Document:l()},userland:g});r()}catch(e){r(e)}})},8141:(e,a,t)=>{Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return l}});let r=t(167),s=t(997),n=r._(t(6689)),o=t(5782);async function i(e){let{Component:a,ctx:t}=e;return{pageProps:await (0,o.loadGetInitialProps)(a,t)}}class l extends n.default.Component{render(){let{Component:e,pageProps:a}=this.props;return(0,s.jsx)(e,{...a})}}l.origGetInitialProps=i,l.getInitialProps=i,("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),e.exports=a.default)},8364:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>c});var s=t(997),n=t(6689),o=t(9648),i=t(8808),l=e([o]);o=(l.then?(await l)():l)[0];let c=()=>{let[e,a]=(0,n.useState)([]),[t,r]=(0,n.useState)([]),[l,c]=(0,n.useState)({packagename:"",price:"",gamename:"",description:"",image:null,gameId:""}),[d,g]=(0,n.useState)(null),p=(0,n.useRef)(null),[m,u]=(0,n.useState)(null),[h,f]=(0,n.useState)(!0),[x,b]=(0,n.useState)(""),[k,y]=(0,n.useState)(""),[j,v]=(0,n.useState)(null),N=async()=>{f(!0),v("Testing API connection...");try{let e=localStorage.getItem("token"),a=e?{Authorization:`Bearer ${e}`}:{};console.log("Testing endpoint: /api/package");let t=await o.default.get((0,i.kG)("/api/package"),{headers:a});console.log("API test response:",t.data),v("API connection successful using endpoint: /api/package")}catch(e){console.error("API connection test failed:",e),v(`API connection test failed: ${e.message}`)}finally{setTimeout(()=>f(!1),500)}};(0,n.useEffect)(()=>{P(),S(),N()},[]),(0,n.useEffect)(()=>{console.log("Current packages data:",e),console.log("Current games data:",t)},[e,t]);let S=async()=>{try{let e=localStorage.getItem("token"),a=e?{Authorization:`Bearer ${e}`}:{};if(!e){console.error("Authentication token not found"),b("Authentication token not found. Please log in again.");return}console.log("Fetching games data from /api/game...");let t=await o.default.get((0,i.kG)("/api/game"),{headers:a});console.log("Games response:",t.data);let s=[];t.data&&Array.isArray(t.data)?s=t.data:t.data&&t.data.data&&Array.isArray(t.data.data)?s=t.data.data:t.data&&t.data.data&&(s=[t.data.data]),r(s),localStorage.setItem("gamesData",JSON.stringify(s))}catch(e){console.error("Error fetching games:",e),b("Failed to fetch games: "+(e.response?.data?.message||e.message));try{let e=localStorage.getItem("gamesData");if(e){let a=JSON.parse(e);Array.isArray(a)&&a.length>0&&(r(a),b("Could not connect to the server. Using locally stored games data."))}}catch(e){console.error("Error using local games fallback:",e)}}},P=async()=>{f(!0),b("");try{let e=localStorage.getItem("token"),t=e?{Authorization:`Bearer ${e}`}:{};if(!e){b("Authentication token not found. Please log in again."),f(!1);return}console.log("Fetching packages from /api/package...");let r=await o.default.get((0,i.kG)("/api/package"),{headers:t});console.log("Packages response:",r.data);let s=[];r.data&&Array.isArray(r.data)?s=r.data:r.data&&r.data.data&&Array.isArray(r.data.data)?s=r.data.data:r.data&&r.data.data&&(s=[r.data.data]),s.length>0&&(console.log("First package structure:",JSON.stringify(s[0],null,2)),console.log("Image field:",s[0].image),console.log("Game name field:",s[0].gamename),console.log("Game ID field:",s[0].gameId)),a(s),y("Packages loaded successfully"),setTimeout(()=>y(""),3e3),localStorage.setItem("packagesData",JSON.stringify(s))}catch(e){console.error("Error fetching packages:",e),b("Failed to fetch packages: "+(e.response?.data?.message||e.message));try{let e=localStorage.getItem("packagesData");if(e){let t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(a(t),b("Could not connect to the server. Using locally stored packages data."))}}catch(e){console.error("Error using local fallback:",e)}}finally{f(!1)}},w=e=>{let{name:a,value:t}=e.target;m?u({...m,[a]:t}):c({...l,[a]:t})},I=async r=>{if(r.preventDefault(),b(""),y(""),l.description.length<10){b("Description must be at least 10 characters long");return}f(!0);try{let e=localStorage.getItem("token"),a=e?{Authorization:`Bearer ${e}`}:{};if(!e){b("Authentication token not found. Please log in again."),f(!1);return}let r=t.find(e=>e.gamename===l.gamename);if(!r||!r._id){b("Please select a valid game from the dropdown. The selected game was not found."),f(!1);return}let s=new FormData;s.append("packagename",l.packagename),s.append("price",l.price),s.append("gamename",l.gamename),s.append("description",l.description),s.append("gameId",r._id),l.image instanceof File&&s.append("image",l.image),console.log("Adding package with data:",{packagename:l.packagename,price:l.price,gamename:l.gamename,description:l.description,gameId:r._id,hasImage:l.image instanceof File});let n=await o.default.post((0,i.kG)("/api/package"),s,{headers:{...a}});console.log("Package added response:",n.data),c({packagename:"",price:"",gamename:"",description:"",image:null,gameId:""}),g(null),p.current&&(p.current.value=""),y("Package added successfully!");let d=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[];d.push({packagename:l.packagename,price:l.price,gamename:l.gamename,description:l.description,gameId:r._id,image:n.data.image||n.data.imageUrl||"",_id:n.data._id||Date.now().toString(),createdAt:new Date().toISOString()}),localStorage.setItem("packagesData",JSON.stringify(d)),P(),setTimeout(()=>y(""),3e3)}catch(s){console.error("Error adding package:",s.response?.data||s.message);let r="Failed to add package: ";s.response?(console.error("Error response data:",s.response.data),console.error("Error response status:",s.response.status),r+=`Server responded with status: ${s.response.status}. `,s.response.data&&"object"==typeof s.response.data?s.response.data.message?r+=s.response.data.message:s.response.data.error?r+=s.response.data.error:r+=JSON.stringify(s.response.data):"string"==typeof s.response.data&&(r+=s.response.data)):s.request?r+="No response received from server. Please check your connection.":r+=s.message,b(r);try{let r=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[],s=t.find(e=>e.gamename===l.gamename),n={packagename:l.packagename,price:l.price,gamename:l.gamename,description:l.description,gameId:s?._id||"",_id:Date.now().toString(),createdAt:new Date().toISOString()};r.push(n),localStorage.setItem("packagesData",JSON.stringify(r)),a([...e,n]),y("Added to local storage only. Server connection failed.")}catch(e){console.error("Error saving to local storage:",e)}}finally{f(!1)}},A=async e=>{if(e.preventDefault(),b(""),y(""),m.description.length<10){b("Description must be at least 10 characters long");return}f(!0);try{let e;let a=localStorage.getItem("token"),r=a?{Authorization:`Bearer ${a}`}:{};if(!a){b("Authentication token not found. Please log in again."),f(!1);return}let s=t.find(e=>e.gamename===m.gamename);if(!s||!s._id){b("Please select a valid game from the dropdown. The selected game was not found."),f(!1);return}if(m.image instanceof File){let a=new FormData;a.append("packagename",m.packagename),a.append("price",m.price),a.append("gamename",m.gamename),a.append("description",m.description),a.append("gameId",s._id),a.append("image",m.image),console.log("Updating package with image:",{id:m._id,packagename:m.packagename,hasImage:!0}),e=await o.default.put((0,i.kG)(`/api/package/${m._id}`),a,{headers:{...r}})}else{let a={packagename:m.packagename,price:m.price,gamename:m.gamename,description:m.description,gameId:s._id};"string"==typeof m.image&&m.image&&(a.keepExistingImage=!0),console.log("Updating package with data:",a),e=await o.default.put((0,i.kG)(`/api/package/${m._id}`),a,{headers:{...r,"Content-Type":"application/json"}})}console.log("Package updated response:",e?.data),y("Package updated successfully!");let n=localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[],l=n.findIndex(e=>e._id===m._id);-1!==l&&(n[l]={...n[l],packagename:m.packagename,price:m.price,gamename:m.gamename,description:m.description,gameId:s._id,image:e?.data?.image||e?.data?.imageUrl||n[l].image,updatedAt:new Date().toISOString()},localStorage.setItem("packagesData",JSON.stringify(n))),u(null),g(null),p.current&&(p.current.value=""),P(),setTimeout(()=>y(""),3e3)}catch(a){console.error("Error updating package:",a.response?.data||a.message);let e="Failed to update package: ";a.response?(console.error("Error response data:",a.response.data),console.error("Error response status:",a.response.status),e+=`Server responded with status: ${a.response.status}. `,a.response.data&&"object"==typeof a.response.data?a.response.data.message?e+=a.response.data.message:a.response.data.error?e+=a.response.data.error:e+=JSON.stringify(a.response.data):"string"==typeof a.response.data&&(e+=a.response.data)):a.request?e+="No response received from server. Please check your connection.":e+=a.message,b(e)}finally{f(!1)}},_=async e=>{if(confirm("Are you sure you want to delete this package?")){b(""),y(""),f(!0);try{let a=localStorage.getItem("token"),t=a?{Authorization:`Bearer ${a}`}:{};if(!a){b("Authentication token not found. Please log in again."),f(!1);return}console.log(`Deleting package with ID: ${e}`),await o.default.delete((0,i.kG)(`/api/package/${e}`),{headers:t}),y("Package deleted successfully!");let r=(localStorage.getItem("packagesData")?JSON.parse(localStorage.getItem("packagesData")):[]).filter(a=>a._id!==e);localStorage.setItem("packagesData",JSON.stringify(r)),P(),setTimeout(()=>y(""),3e3)}catch(a){console.error("Error deleting package:",a.response?.data||a.message);let e="Failed to delete package: ";a.response?(console.error("Error response data:",a.response.data),console.error("Error response status:",a.response.status),e+=`Server responded with status: ${a.response.status}. `,a.response.data&&"object"==typeof a.response.data?a.response.data.message?e+=a.response.data.message:a.response.data.error?e+=a.response.data.error:e+=JSON.stringify(a.response.data):"string"==typeof a.response.data&&(e+=a.response.data)):a.request?e+="No response received from server. Please check your connection.":e+=a.message,b(e)}finally{f(!1)}}};return(0,s.jsxs)("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Available Packages"}),j&&s.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("p",{children:j}),s.jsx("div",{children:s.jsx("button",{onClick:N,className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition-colors",disabled:h,children:"Test API"})})]})}),k&&s.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:s.jsx("p",{children:k})}),x&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:[s.jsx("p",{children:x}),s.jsx("button",{className:"mt-2 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded",onClick:P,children:"Try Again"})]}),(0,s.jsxs)("form",{onSubmit:m?A:I,className:"mb-6 p-6 bg-gray-200 rounded",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:m?"Edit Package":"Add New Package"}),x&&s.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:x}),s.jsx("input",{type:"text",name:"packagename",placeholder:"Package Name",value:m?m.packagename:l.packagename,onChange:w,className:"border p-2 w-full mb-2",required:!0}),s.jsx("input",{type:"text",name:"price",placeholder:"Price",value:m?m.price:l.price,onChange:w,className:"border p-2 w-full mb-2",required:!0}),(0,s.jsxs)("select",{name:"gamename",value:m?m.gamename:l.gamename,onChange:w,className:"border p-2 w-full mb-2",required:!0,children:[s.jsx("option",{value:"",children:"Select a Game"}),t.map(e=>s.jsx("option",{value:e.gamename,children:e.gamename},e._id))]}),s.jsx("textarea",{name:"description",placeholder:"Description (minimum 10 characters)",value:m?m.description:l.description,onChange:w,className:`border p-2 w-full mb-1 ${m&&m.description.length<10||!m&&l.description.length<10&&l.description.length>0?"border-red-500":""}`,required:!0}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-4 flex justify-between",children:[s.jsx("span",{children:"Minimum 10 characters required"}),s.jsx("span",{children:m?`${m.description.length}/10 characters`:`${l.description.length}/10 characters`})]}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Image"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"file",accept:"image/*",ref:p,onChange:e=>{let a=e.target.files[0];if(!a)return;if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(a.type)){b("Please select a valid image file (JPEG, PNG, JPG, GIF)");return}if(a.size>2097152){b("Image size should be less than 2MB");return}let t=new FileReader;t.onloadend=()=>{g(t.result),m?u({...m,image:a}):c({...l,image:a})},t.readAsDataURL(a)},className:"hidden",id:"packageImageUpload"}),(0,s.jsxs)("label",{htmlFor:"packageImageUpload",className:"cursor-pointer bg-blue-500 hover:bg-blue-600 text-white rounded px-3 py-2 text-sm flex-grow flex items-center justify-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),m?.image?"string"==typeof m.image?"Change image":`Selected: ${m.image.name.substring(0,15)}${m.image.name.length>15?"...":""}`:l?.image?.name?`Selected: ${l.image.name.substring(0,15)}${l.image.name.length>15?"...":""}`:"Choose image file..."]}),s.jsx("button",{type:"button",onClick:()=>{m?u({...m,image:null}):c({...l,image:null}),g(null),p.current&&(p.current.value="")},className:"bg-red-500 hover:bg-red-600 text-white px-2 py-2 rounded text-sm",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"mt-2",children:s.jsx("div",{className:"relative w-32 h-32 border rounded overflow-hidden bg-gray-100",children:d?s.jsx("img",{src:d,alt:"Preview",className:"w-full h-full object-cover"}):m&&"string"==typeof m.image&&m.image?s.jsx("img",{src:m.image.startsWith("http")?m.image:(0,i.kG)(`/${m.image}`),alt:m.packagename,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/100?text=No+Image"}}):s.jsx("div",{className:"flex items-center justify-center h-full w-full bg-gray-200 text-gray-500 text-xs text-center p-2",children:s.jsx("span",{children:"No image selected"})})})})]}),s.jsx("button",{type:"submit",className:`${m?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"} text-white px-4 py-2 rounded transition-colors`,disabled:h||m&&m.description.length<10||!m&&l.description.length<10,children:h?m?"Updating...":"Adding...":m?"Update Package":"Add Package"}),(m&&m.description.length<10||!m&&l.description.length<10)&&s.jsx("div",{className:"mt-2 text-sm text-orange-600",children:s.jsx("p",{children:"Note: Button will be enabled when description has at least 10 characters"})})]}),h?s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{children:"Loading packages..."})}):x&&0===e.length?s.jsx("div",{className:"text-center py-4 text-red-500",children:s.jsx("p",{children:x})}):0===e.length?s.jsx("p",{children:"No packages found."}):(0,s.jsxs)("table",{className:"w-full border border-gray-300 rounded",children:[s.jsx("thead",{className:"bg-[#0e08ab] text-white",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"border p-2",children:"Package ID"}),s.jsx("th",{className:"border p-2",children:"Name"}),s.jsx("th",{className:"border p-2",children:"Price"}),s.jsx("th",{className:"border p-2",children:"Game"}),s.jsx("th",{className:"border p-2",children:"Description"}),s.jsx("th",{className:"border p-2",children:"Image"}),s.jsx("th",{className:"border p-2",children:"Actions"})]})}),s.jsx("tbody",{children:e.map(e=>(0,s.jsxs)("tr",{className:"text-center bg-gray-100",children:[s.jsx("td",{className:"border p-2",children:e._id}),s.jsx("td",{className:"border p-2",children:e.packagename}),s.jsx("td",{className:"border p-2",children:e.price}),s.jsx("td",{className:"border p-2",children:e.gamename||e.gameId&&t.find(a=>a._id===e.gameId)?.gamename||"Unknown Game"}),s.jsx("td",{className:"border p-2",children:e.description}),s.jsx("td",{className:"border p-2",children:e.image?s.jsx("div",{className:"h-16 w-16 mx-auto overflow-hidden rounded bg-gray-100",children:s.jsx("img",{src:e.image.startsWith("http")?e.image:(0,i.kG)(`/${e.image}`),alt:e.packagename,className:"h-full w-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/100?text=Error"}})}):s.jsx("div",{className:"h-16 w-16 mx-auto flex items-center justify-center bg-gray-200 rounded",children:s.jsx("span",{className:"text-xs text-gray-500",children:"No image"})})}),(0,s.jsxs)("td",{className:"border p-2 space-x-2",children:[s.jsx("button",{onClick:()=>{if(e.image&&"string"==typeof e.image){let a=e.image.startsWith("http")?e.image:(0,i.kG)(`/${e.image}`);g(a)}else g(null);u(e),p.current&&(p.current.value="")},className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded transition-colors",children:"Edit"}),s.jsx("button",{onClick:()=>_(e._id),className:"bg-red-500 text-white px-3 py-1 rounded",children:"Delete"})]})]},e._id))})]}),(0,s.jsxs)("div",{className:"mt-6 flex justify-between items-center text-sm text-gray-500",children:[s.jsx("div",{children:(0,s.jsxs)("p",{children:["Total Packages: ",e.length]})}),s.jsx("div",{children:s.jsx("button",{onClick:P,className:"text-blue-600 hover:text-blue-800 underline",disabled:h,children:h?"Refreshing...":"Refresh Data"})})]})]})};r()}catch(e){r(e)}})},8808:(e,a,t)=>{t.d(a,{NU:()=>n,kG:()=>s});let r=process.env.NEXT_PUBLIC_API_URL||"/api",s=e=>{let a=e.startsWith("/")?e.slice(1):e;return`${r}/${a}`},n=e=>{let a={"Content-Type":"application/json"};return e&&(a.Authorization=`Bearer ${e}`),a}},5244:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},5315:e=>{e.exports=require("path")},9648:e=>{e.exports=import("axios")}};var a=require("../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[682],()=>t(8421));module.exports=r})();