"use strict";(()=>{var e={};e.id=626,e.ids=[626,660],e.modules={1323:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9292:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>m,getServerSideProps:()=>f,getStaticPaths:()=>h,getStaticProps:()=>g,reportWebVitals:()=>b,routeModule:()=>w,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>N,unstable_getStaticParams:()=>A,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>v});var s=r(7093),o=r(5244),l=r(1323),n=r(1682),i=r.n(n),d=r(8141),c=r.n(d),u=r(8429),p=e([u]);u=(p.then?(await p)():p)[0];let m=(0,l.l)(u,"default"),g=(0,l.l)(u,"getStaticProps"),h=(0,l.l)(u,"getStaticPaths"),f=(0,l.l)(u,"getServerSideProps"),x=(0,l.l)(u,"config"),b=(0,l.l)(u,"reportWebVitals"),v=(0,l.l)(u,"unstable_getStaticProps"),y=(0,l.l)(u,"unstable_getStaticPaths"),A=(0,l.l)(u,"unstable_getStaticParams"),j=(0,l.l)(u,"unstable_getServerProps"),N=(0,l.l)(u,"unstable_getServerSideProps"),w=new s.PagesRouteModule({definition:{kind:o.x.PAGES,page:"/Admin_Dashbord/Users",pathname:"/Admin_Dashbord/Users",bundlePath:"",filename:""},components:{App:c(),Document:i()},userland:u});a()}catch(e){a(e)}})},8141:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let a=r(167),s=r(997),o=a._(r(6689)),l=r(5782);async function n(e){let{Component:t,ctx:r}=e;return{pageProps:await (0,l.loadGetInitialProps)(t,r)}}class i extends o.default.Component{render(){let{Component:e,pageProps:t}=this.props;return(0,s.jsx)(e,{...t})}}i.origGetInitialProps=n,i.getInitialProps=n,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2603:(e,t,r)=>{r.d(t,{Hz:()=>o});let a=process.env.NEXT_PUBLIC_API_URL||"/api",s={auth:{login:`${a}/auth/login`,register:`${a}/auth/register`,logout:`${a}/auth/logout`,verify:`${a}/auth/verify`},users:`${a}/users`,games:`${a}/games`,packages:`${a}/packages`,orders:`${a}/orders`},o={API_BASE_URL:a,API_ENDPOINTS:s,LOGGING_ENABLED:"true"===process.env.VITE_API_LOGGING}},8429:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>d});var s=r(997),o=r(6689),l=r(9648);r(2603);var n=r(8808),i=e([l]);l=(i.then?(await i)():i)[0];let d=()=>{let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(null),[i,d]=(0,o.useState)({name:"",email:"",phone:"",role:""}),[c,u]=(0,o.useState)(!0),[p,m]=(0,o.useState)(null),[g,h]=(0,o.useState)(!1),[f,x]=(0,o.useState)(!1),[b,v]=(0,o.useState)({name:"",email:"",phone:"",password:"",role:"user"}),y=e=>{if(!e)return"user";let t="string"==typeof e?e.toLowerCase():String(e).toLowerCase();return"admin"===t||"administrator"===t?"admin":"user"};(0,o.useEffect)(()=>{A()},[]);let A=async()=>{u(!0),m(null);try{let e=localStorage.getItem("token");if(!e){m("Authentication token not found. Please login again."),u(!1);return}console.log("Fetching users with token:",e);let r=!1,a=[];try{let t=await l.default.get((0,n.kG)("/api/users"),{headers:{Authorization:`Bearer ${e}`}});console.log("Primary API response:",t.data),Array.isArray(t.data)?(a=t.data,r=!0):t.data&&Array.isArray(t.data.users)?(a=t.data.users,r=!0):t.data&&"object"==typeof t.data&&(a=[t.data],r=!0)}catch(t){console.error("Primary endpoint failed, trying alternative endpoint",t);try{let t=await l.default.get((0,n.kG)("/api/user-management/users"),{headers:{Authorization:`Bearer ${e}`}});console.log("Alternative API response:",t.data),Array.isArray(t.data)?(a=t.data,r=!0):t.data&&Array.isArray(t.data.users)?(a=t.data.users,r=!0):t.data&&"object"==typeof t.data&&(a=[t.data],r=!0)}catch(t){console.error("Alternative endpoint also failed",t);try{let t=await l.default.get((0,n.kG)("/api/user/all"),{headers:{Authorization:`Bearer ${e}`}});console.log("Third API response:",t.data),Array.isArray(t.data)?(a=t.data,r=!0):t.data&&Array.isArray(t.data.users)?(a=t.data.users,r=!0):t.data&&"object"==typeof t.data&&(a=[t.data],r=!0)}catch(e){console.error("Third endpoint also failed",e)}}}if(!r){console.log("All API endpoints failed, falling back to localStorage");let e=JSON.parse(localStorage.getItem("users")||"[]");console.log("Users from localStorage:",e),a=e,0===a.length&&(a=[{_id:"admin_default",name:"Admin User",email:"admin@example.com",phone:"1234567890",role:"admin",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],localStorage.setItem("users",JSON.stringify(a)),console.log("Created default admin in localStorage"))}a.forEach(e=>{console.log(`User ${e._id}: role = ${e.role}, normalized = ${y(e.role)}`)}),t(a),u(!1)}catch(e){console.error("Error fetching users:",e),m("Failed to fetch users. "+(e.response?.data?.message||e.message));try{let e=JSON.parse(localStorage.getItem("users")||"[]");console.log("Error recovery: Using users from localStorage:",e),t(e)}catch(e){console.error("Error reading from localStorage:",e),t([])}u(!1)}},j=async(e,t)=>{if(!e){m("Cannot update user without an ID");return}try{let r=localStorage.getItem("token");if(!r){m("Authentication token not found. Please login again.");return}let a=!1;try{try{console.log(`Toggling user status to: ${!t}`),await l.default.patch((0,n.kG)(`/api/users/status/${e}`),{isActive:!t},{headers:{Authorization:`Bearer ${r}`}}),a=!0}catch(s){console.error("Status endpoint failed, trying alternative endpoint:",s);try{await l.default.patch((0,n.kG)(`/api/users/${e}/status`),{isActive:!t},{headers:{Authorization:`Bearer ${r}`}}),a=!0}catch(s){console.error("Alternative endpoint failed, trying standard update with active field:",s);try{await l.default.patch((0,n.kG)(`/api/users/${e}`),{isActive:!t,active:!t,status:t?"inactive":"active"},{headers:{Authorization:`Bearer ${r}`}}),a=!0}catch(e){console.error("All API endpoints failed:",e)}}}}catch(e){console.error("API failed:",e)}if(!a){console.log("API calls failed, using localStorage for status toggle");let r=JSON.parse(localStorage.getItem("users")||"[]").map(r=>r._id===e?{...r,isActive:!t,active:!t,updatedAt:new Date().toISOString()}:r);localStorage.setItem("users",JSON.stringify(r)),console.log("User status updated in localStorage")}A()}catch(e){console.error("Error updating user status:",e),m("Failed to update user status. "+(e.response?.data?.message||e.message))}},N=async e=>{if(!e){m("Cannot delete user without an ID");return}if(window.confirm("Are you sure you want to delete this user?"))try{u(!0);let t=localStorage.getItem("token");if(!t){m("Authentication token not found. Please login again."),u(!1);return}console.log(`Attempting to delete user with ID: ${e}`);let r=!1;try{await l.default.delete((0,n.kG)(`/api/users/${e}`),{headers:{Authorization:`Bearer ${t}`}}),console.log("User deleted successfully"),r=!0}catch(a){console.error("Primary delete endpoint failed:",a);try{await l.default.delete((0,n.kG)(`/api/user/${e}`),{headers:{Authorization:`Bearer ${t}`}}),console.log("User deleted successfully via alternative endpoint"),r=!0}catch(e){console.error("Alternative delete endpoint failed:",e)}}if(!r){console.log("API calls failed, using localStorage for user deletion");let t=JSON.parse(localStorage.getItem("users")||"[]").filter(t=>t._id!==e);localStorage.setItem("users",JSON.stringify(t)),console.log("User deleted from localStorage")}alert("User deleted successfully"),A()}catch(e){console.error("Error deleting user:",e),e.response?(console.error("API response status:",e.response.status),console.error("API response data:",e.response.data),m("Failed to delete user: "+(e.response.data?.message||e.message))):e.request?(console.error("No response received:",e.request),m("Failed to delete user: No response from server. Check your network connection.")):(console.error("Error details:",e),m("Failed to delete user: "+(e.message||"Unknown error"))),u(!1)}},w=e=>{if(!e||!e._id){m("Cannot edit user without proper data");return}console.log("Starting edit for user:",e);let t=y(e.role);console.log("Current user role:",t,"Original value:",e.role),a(e._id),d({name:e.name||"",email:e.email||"",phone:e.phone||"",role:t}),console.log("Form data initialized:",{name:e.name||"",email:e.email||"",phone:e.phone||"",role:t})},S=async e=>{if(!e){m("Cannot save user without an ID");return}h(!0),m(null);try{let t=localStorage.getItem("token");if(!t){m("Authentication token not found. Please login again."),h(!1);return}console.log("Saving user with ID:",e),console.log("Form data being sent:",i);let r={name:i.name,email:i.email,phone:i.phone,role:i.role};console.log("Final data being sent:",r);let s=!1,o=null;try{o=await l.default.put((0,n.kG)(`/api/users/${e}`),r,{headers:{Authorization:`Bearer ${t}`}}),s=!0,console.log("Update successful via PUT /api/users/:id",o.data)}catch(a){console.error("PUT request failed, trying PATCH",a);try{o=await l.default.patch((0,n.kG)(`/api/users/${e}`),r,{headers:{Authorization:`Bearer ${t}`}}),s=!0,console.log("Update successful via PATCH /api/users/:id",o.data)}catch(a){console.error("PATCH request also failed, trying alternative endpoint",a);try{o=await l.default.put((0,n.kG)(`/api/user/${e}`),r,{headers:{Authorization:`Bearer ${t}`}}),s=!0,console.log("Update successful via PUT /api/user/:id",o.data)}catch(e){console.error("All update attempts failed",e)}}}if(!s){console.log("API calls failed, using localStorage for user update");let t=JSON.parse(localStorage.getItem("users")||"[]").map(t=>t._id===e?{...t,name:i.name,email:i.email,phone:i.phone,role:i.role,updatedAt:new Date().toISOString()}:t);localStorage.setItem("users",JSON.stringify(t)),console.log("User updated in localStorage")}alert("User updated successfully"),a(null),A()}catch(e){console.error("Error editing user:",e),e.response?(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),m("Failed to save user: "+(e.response.data?.message||e.message))):e.request?(console.error("No response received:",e.request),m("Failed to save user: No response from server. Check your network connection.")):(console.error("Error details:",e),m("Failed to save user: "+(e.message||"Unknown error")))}finally{h(!1)}},P=async()=>{if(!b.name||!b.email||!b.password){m("Name, email, and password are required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.email)){m("Please enter a valid email address");return}u(!0),m(null);try{let e=localStorage.getItem("token");if(!e){m("Authentication token not found. Please login again."),u(!1);return}console.log("Creating new user:",b);let t=!1;try{let r=await l.default.post((0,n.kG)("/api/users"),b,{headers:{Authorization:`Bearer ${e}`}});console.log("User created successfully:",r.data),t=!0}catch(r){console.error("Primary create endpoint failed:",r);try{let r=await l.default.post((0,n.kG)("/api/auth/register"),{...b,isAdmin:"admin"===b.role},{headers:{Authorization:`Bearer ${e}`}});console.log("User created successfully via alternative endpoint:",r.data),t=!0}catch(e){console.error("Alternative create endpoint failed:",e)}}if(!t){console.log("API calls failed, using localStorage fallback");let e=JSON.parse(localStorage.getItem("users")||"[]"),t={_id:"user_"+Date.now(),name:b.name,email:b.email,phone:b.phone||"",password:b.password,role:b.role,isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};e.push(t),localStorage.setItem("users",JSON.stringify(e)),console.log("User saved to localStorage:",t)}alert(`${"admin"===b.role?"Admin":"User"} created successfully!`),v({name:"",email:"",phone:"",password:"",role:"user"}),x(!1),A()}catch(e){console.error("Error creating user:",e),e.response?(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),m("Failed to create user: "+(e.response.data?.message||e.message))):e.request?(console.error("No response received:",e.request),m("Failed to create user: No response from server. Check your network connection.")):(console.error("Error details:",e),m("Failed to create user: "+(e.message||"Unknown error")))}finally{u(!1)}};return(0,s.jsxs)("div",{className:"p-2 sm:p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Users"}),(0,s.jsxs)("div",{className:"space-x-2",children:[s.jsx("button",{className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md",onClick:()=>{x(!0),v({name:"",email:"",phone:"",password:"",role:"admin"})},children:"Add Admin"}),s.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",onClick:()=>{x(!0),v({name:"",email:"",phone:"",password:"",role:"user"})},children:"Add User"})]})]}),f&&(0,s.jsxs)("div",{className:"bg-gray-100 p-4 mb-6 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"admin"===b.role?"Add New Admin":"Add New User"}),s.jsx("button",{className:"text-gray-600 hover:text-gray-800",onClick:()=>x(!1),children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),s.jsx("input",{type:"text",value:b.name,onChange:e=>v({...b,name:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Full Name"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),s.jsx("input",{type:"email",value:b.email,onChange:e=>v({...b,email:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Email Address"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),s.jsx("input",{type:"text",value:b.phone,onChange:e=>v({...b,phone:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Phone Number"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),s.jsx("input",{type:"password",value:b.password,onChange:e=>v({...b,password:e.target.value}),className:"border p-2 w-full rounded",placeholder:"Password"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,s.jsxs)("select",{value:b.role,onChange:e=>v({...b,role:e.target.value}),className:"border p-2 w-full rounded",children:[s.jsx("option",{value:"user",children:"User"}),s.jsx("option",{value:"admin",children:"Admin"})]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:(0,s.jsxs)("button",{className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",onClick:P,children:["Create ","admin"===b.role?"Admin":"User"]})})]}),p&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[s.jsx("p",{children:p}),s.jsx("button",{className:"mt-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded",onClick:A,children:"Try Again"})]}),c?s.jsx("div",{className:"flex justify-center items-center h-40",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):s.jsx("div",{className:"overflow-x-auto",children:Array.isArray(e)&&0!==e.length?(0,s.jsxs)("table",{className:"w-full border text-xs sm:text-base",children:[s.jsx("thead",{children:(0,s.jsxs)("tr",{className:"bg-[#0e08ab] text-white",children:[s.jsx("th",{className:"p-2 border",children:"ID"}),s.jsx("th",{className:"p-2 border",children:"Name"}),s.jsx("th",{className:"p-2 border",children:"Email"}),s.jsx("th",{className:"p-2 border",children:"Phone"}),s.jsx("th",{className:"p-2 border",children:"Role"}),s.jsx("th",{className:"p-2 border",children:"Status"}),s.jsx("th",{className:"p-2 border",children:"Actions"})]})}),s.jsx("tbody",{children:e.map((e,t)=>(0,s.jsxs)("tr",{className:"bg-white even:bg-gray-100",children:[s.jsx("td",{className:"p-2 border break-all",children:e._id||"N/A"}),r===e._id?(0,s.jsxs)(s.Fragment,{children:[s.jsx("td",{className:"p-2 border",children:s.jsx("input",{type:"text",value:i.name,onChange:e=>d({...i,name:e.target.value}),className:"border p-1 w-full"})}),s.jsx("td",{className:"p-2 border",children:s.jsx("input",{type:"email",value:i.email,onChange:e=>d({...i,email:e.target.value}),className:"border p-1 w-full"})}),s.jsx("td",{className:"p-2 border",children:s.jsx("input",{type:"text",value:i.phone,onChange:e=>d({...i,phone:e.target.value}),className:"border p-1 w-full"})}),s.jsx("td",{className:"p-2 border",children:(0,s.jsxs)("select",{value:i.role,onChange:e=>{console.log("Role changed to:",e.target.value),d({...i,role:e.target.value})},className:"border p-1 w-full",children:[s.jsx("option",{value:"user",children:"User"}),s.jsx("option",{value:"admin",children:"Admin"})]})})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx("td",{className:"p-2 border break-all",children:e.name||"N/A"}),s.jsx("td",{className:"p-2 border break-all",children:e.email||"N/A"}),s.jsx("td",{className:"p-2 border break-all",children:e.phone||"N/A"}),s.jsx("td",{className:"p-2 border",children:"admin"===y(e.role)?s.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full",children:"Admin"}):s.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:"User"})})]}),s.jsx("td",{className:"p-2 border",children:e.isActive||e.active?"Active":"Inactive"}),(0,s.jsxs)("td",{className:"p-2 border flex gap-2 flex-wrap",children:[s.jsx("button",{onClick:()=>j(e._id,e.isActive||e.active),className:`px-2 py-1 rounded text-white ${e.isActive||e.active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:e.isActive||e.active?"Deactivate":"Activate"}),r===e._id?(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>S(e._id),className:"px-2 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white flex items-center",disabled:g,children:g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"}),s.jsx("button",{onClick:()=>a(null),className:"px-2 py-1 rounded bg-gray-500 hover:bg-gray-600 text-white",disabled:g,children:"Cancel"})]}):s.jsx("button",{onClick:()=>w(e),className:"px-2 py-1 rounded bg-yellow-500 hover:bg-yellow-600 text-white",children:"Edit"}),s.jsx("button",{onClick:()=>N(e._id),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-800 text-white",children:"Delete"})]})]},e._id||`user-${t}`))})]}):s.jsx("p",{className:"text-center py-4",children:"No users found"})})]})};a()}catch(e){a(e)}})},8808:(e,t,r)=>{r.d(t,{NU:()=>o,kG:()=>s});let a=process.env.NEXT_PUBLIC_API_URL||"/api",s=e=>`${a}/${e}`,o=e=>{let t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}},5244:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},5315:e=>{e.exports=require("path")},9648:e=>{e.exports=import("axios")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[682],()=>r(9292));module.exports=a})();